---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import ServiceCard from '../components/ServiceCard.astro';

export const prerender = false;

const query = Astro.url.searchParams.get('q') || '';
const city = Astro.url.searchParams.get('oras') || '';
const category = Astro.url.searchParams.get('categorie') || '';

const categories = [
  { value: 'stomatologie', label: 'Stomatologie', icon: 'ü¶∑' },
  { value: 'auto', label: 'Service Auto', icon: 'üöó' },
  { value: 'frizerie', label: 'Frizerii & Saloane', icon: 'üíá' },
  { value: 'curatenie', label: 'CurƒÉ»õenie', icon: 'üßπ' },
  { value: 'instalatii', label: 'Instala»õii', icon: 'üîß' },
  { value: 'electricieni', label: 'Electricieni', icon: '‚ö°' },
];

const cities = ['Bucure»ôti', 'Cluj-Napoca', 'Timi»ôoara', 'Ia»ôi', 'Constan»õa', 'Bra»ôov', 'Craiova', 'Gala»õi'];

// Mock results
const results = [
  { id: '1', name: 'Dent Smile Studio', category: 'Stomatologie', categorySlug: 'stomatologie', location: 'Bucure»ôti', rating: 4.9, reviewCount: 127, price: 'de la 100 lei', isPremium: true, isVerified: true },
  { id: '2', name: 'Auto Expert Service', category: 'Service Auto', categorySlug: 'auto', location: 'Cluj-Napoca', rating: 4.8, reviewCount: 89, price: 'de la 150 lei', isPremium: true, isVerified: true },
  { id: '3', name: 'Elegant Hair Studio', category: 'Frizerie', categorySlug: 'frizerie', location: 'Timi»ôoara', rating: 4.7, reviewCount: 203, price: 'de la 50 lei', isPremium: false, isVerified: true },
];
---

<Layout title={`CƒÉutare${query ? `: ${query}` : ''} - LocalPro`}>
  <Navbar />
  
  <main class="search-page">
    <section class="search-hero">
      <div class="container">
        <h1 class="heading-lg">
          {query ? `Rezultate pentru "${query}"` : 'CautƒÉ servicii'}
        </h1>
        
        <form class="search-form" id="search-form">
          <div class="search-box">
            <div class="search-box__input-wrapper">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
              </svg>
              <input type="text" name="q" class="search-box__input" placeholder="Ce serviciu cau»õi?" value={query} />
            </div>
            
            <div class="search-box__divider"></div>
            
            <div class="search-box__location">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/>
              </svg>
              <select name="oras" class="search-box__select">
                <option value="">Toate ora»ôele</option>
                {cities.map(c => (
                  <option value={c.toLowerCase()} selected={city === c.toLowerCase()}>{c}</option>
                ))}
              </select>
            </div>
            
            <button type="submit" class="search-box__btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
              </svg>
              CautƒÉ
            </button>
          </div>
        </form>
      </div>
    </section>
    
    <section class="search-results">
      <div class="container">
        <div class="results-layout">
          <!-- Filters Sidebar -->
          <aside class="filters-sidebar">
            <div class="filters-card">
              <h3>Filtre</h3>
              
              <div class="filter-group">
                <h4>Categorie</h4>
                {categories.map(cat => (
                  <label class="filter-checkbox">
                    <input type="checkbox" name="categorie" value={cat.value} checked={category === cat.value} />
                    <span>{cat.icon} {cat.label}</span>
                  </label>
                ))}
              </div>
              
              <div class="filter-group">
                <h4>Rating minim</h4>
                <div class="rating-filter">
                  {[4, 3, 2].map(r => (
                    <label class="filter-radio">
                      <input type="radio" name="rating" value={r} />
                      <span>{'‚≠ê'.repeat(r)}+ ({r}.0+)</span>
                    </label>
                  ))}
                </div>
              </div>
              
              <div class="filter-group">
                <h4>Op»õiuni</h4>
                <label class="filter-checkbox">
                  <input type="checkbox" name="premium" />
                  <span>Doar Premium</span>
                </label>
                <label class="filter-checkbox">
                  <input type="checkbox" name="verified" />
                  <span>Doar Verificate</span>
                </label>
              </div>
              
              <button class="btn btn--primary btn--full" id="apply-filters">AplicƒÉ filtre</button>
              <button class="btn btn--ghost btn--full mt-2" id="clear-filters">ReseteazƒÉ</button>
            </div>
          </aside>
          
          <!-- Results Grid -->
          <div class="results-main">
            <div class="results-header">
              <span class="results-count">{results.length} rezultate gƒÉsite</span>
              <select class="form-input form-select results-sort">
                <option>Sortare: RelevantƒÉ</option>
                <option>Rating (descrescƒÉtor)</option>
                <option>Cele mai multe recenzii</option>
                <option>Cele mai noi</option>
              </select>
            </div>
            
            {results.length > 0 ? (
              <div class="grid grid-2">
                {results.map(service => (
                  <ServiceCard {...service} />
                ))}
              </div>
            ) : (
              <div class="no-results">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                </svg>
                <h3>Nu am gƒÉsit rezultate</h3>
                <p class="text-muted">√éncearcƒÉ sƒÉ modifici criteriile de cƒÉutare sau exploreazƒÉ categoriile noastre.</p>
                <a href="/categorii" class="btn btn--primary">Vezi categorii</a>
              </div>
            )}
            
            {results.length > 0 && (
              <div class="pagination">
                <button class="pagination__btn" disabled>‚Äπ</button>
                <button class="pagination__btn pagination__btn--active">1</button>
                <button class="pagination__btn">2</button>
                <button class="pagination__btn">3</button>
                <button class="pagination__btn">‚Ä∫</button>
              </div>
            )}
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <Footer />
</Layout>

<style>
  .search-page {
    padding-top: 80px;
  }
  
  .search-hero {
    background: var(--bg-secondary);
    padding: 3rem 0;
    border-bottom: 1px solid var(--border-color);
  }
  
  .search-hero h1 {
    margin-bottom: 1.5rem;
  }
  
  .search-form .search-box {
    max-width: 100%;
  }
  
  .search-results {
    padding: 3rem 0;
  }
  
  .results-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 2rem;
  }
  
  @media (max-width: 1024px) {
    .results-layout {
      grid-template-columns: 1fr;
    }
    
    .filters-sidebar {
      display: none;
    }
  }
  
  .filters-card {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    position: sticky;
    top: 100px;
  }
  
  .filters-card h3 {
    font-size: 1.1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
  }
  
  .filter-group {
    margin-bottom: 1.5rem;
  }
  
  .filter-group h4 {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 0.75rem;
  }
  
  .filter-checkbox,
  .filter-radio {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0;
    cursor: pointer;
    font-size: 0.9rem;
  }
  
  .filter-checkbox input,
  .filter-radio input {
    accent-color: var(--accent-primary);
  }
  
  .results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }
  
  .results-count {
    color: var(--text-muted);
  }
  
  .results-sort {
    width: auto;
    padding: 0.5rem 2.5rem 0.5rem 1rem;
  }
  
  .no-results {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
  }
  
  .no-results svg {
    color: var(--text-muted);
    margin-bottom: 1.5rem;
    opacity: 0.5;
  }
  
  .no-results h3 {
    margin-bottom: 0.5rem;
  }
  
  .no-results p {
    margin-bottom: 1.5rem;
  }
  
  .grid-2 {
    grid-template-columns: repeat(2, 1fr);
  }
  
  @media (max-width: 768px) {
    .grid-2 {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  document.getElementById('search-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const form = e.target as HTMLFormElement;
    const formData = new FormData(form);
    const params = new URLSearchParams();
    
    formData.forEach((value, key) => {
      if (value) params.set(key, value.toString());
    });
    
    window.location.href = `/cautare?${params.toString()}`;
  });
  
  document.getElementById('clear-filters')?.addEventListener('click', () => {
    window.location.href = '/cautare';
  });
</script>
